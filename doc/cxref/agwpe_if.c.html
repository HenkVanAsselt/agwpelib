<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<!-- This HTML file generated by cxref. -->
<!-- cxref program (c) Andrew M. Bishop 1995,96,97,98,99. -->

<!--
Cxref: cxref -DTN_SRV -Id:/djgpp/include -O../doc/cxref -xref-all -Nsv2agw -index-all -html32 -html32-src agwpe_if.c
CPP  : gcc -E -C -dD -dI -DTN_SRV -Id:/djgpp/include
-->

<HTML>

<HEAD>
<TITLE>Cross reference for agwpe_if.c of sv2agw.</TITLE>
</HEAD>

<BODY>

<h1><a name="file" href="agwpe_if.c.src.html">File agwpe_if.c</a></h1>
<b>RCS Header: /djgpp/sv2agw/agwpe_if.c 1.0 Fri 07-21-2000 3:53:22 pm </b>
<p>

FILE: agwpe_if.c
DESC: Interface between libsock and AGWPE/TCP
HIST: 20000712 V0.1
<p>

<hr>
<h2>Included Files</h2>

 Normal includes  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdio.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdlib.h&gt;</tt>
</ul>
 Includes for network functionality  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/netinet/in.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/sys/socket.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/netdb.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/arpa/inet.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/unistd.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/lsck/lsck.h&gt;</tt>
</ul>
 For fnctl() -&gt; non-blocking  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/fcntl.h&gt;</tt>
</ul>
 Include own header files  
<p>
<ul>
<li><tt><a href="fortify.h.html#file">#include &quot;fortify.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdlib.h&gt;</tt>
<li><tt>#include &lt;d:/djgpp/include/string.h&gt;</tt>
<li><tt><a href="ufortify.h.html#file">#include &quot;ufortify.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdio.h&gt;</tt>
<li><tt>#include &lt;stdlib.h&gt;</tt>
</ul>
</ul>
<ul>
<li><tt><a href="agwhdr.h.html#file">#include &quot;agwhdr.h&quot;</a></tt>
</ul>
<ul>
<li><tt><a href="agwpe_if.h.html#file">#include &quot;agwpe_if.h&quot;</a></tt>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
<li><tt><a href="agwhdr.h.html#file">#include &quot;agwhdr.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="agwsubs.h.html#file">#include &quot;agwsubs.h&quot;</a></tt>
<ul>
<li><tt><a href="agwhdr.h.html#file">#include &quot;agwhdr.h&quot;</a></tt>
</ul>
</ul>

<hr>
<h2>Preprocessor definitions</h2>

<tt><a href="agwpe_if.c.src.html#line148">#define BUFSIZE</a> 256</tt><br>

<hr>
<h2>External Variables</h2>

<b><a name="var-agwpe_status">agwpe_status</a></b><br>
 External variables 
<p>
<tt><a href="agwpe_if.c.src.html#line41">extern int agwpe_status</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2>Local Variables</h2>

<b><a name="var-port">port</a></b><br>
 Local variables   TCP IP portnumber to use  
<p>
<tt><a href="agwpe_if.c.src.html#line36">static unsigned short port</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-agw_tcp_init">agw_tcp_init()</a>

</table>
<p>
<b><a name="var-host">host</a></b><br>
 Host address  
<p>
<tt><a href="agwpe_if.c.src.html#line37">static unsigned long int host</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-agw_tcp_init">agw_tcp_init()</a>

</table>
<p>
<b><a name="var-agwpe_sock">agwpe_sock</a></b><br>
 Socket number which will be assigned for communcation to AGWPE 
<p>
<tt><a href="agwpe_if.c.src.html#line38">static int agwpe_sock</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-agw_tcp_close">agw_tcp_close()</a>
<tr><td>&nbsp;
<td><a href="#func-agw_tcp_init">agw_tcp_init()</a>
<tr><td>&nbsp;
<td><a href="#func-agw_tcp_send">agw_tcp_send()</a>
<tr><td>&nbsp;
<td><a href="#func-get_tcp_data">get_tcp_data()</a>

</table>

<hr>
<h2><a name="func-agw_tcp_close">Global Function agw_tcp_close()</a></h2>
Description: Close socket used for the connection to AGWPE
<p>
<tt><a href="agwpe_if.c.src.html#line92">void agw_tcp_close ( void )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td colspan=2>close()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>Used in:
<td><a href="agwsubs.c.html#func-agwpe_init">agwpe_init()</a><td><a href="agwsubs.c.html#func-agwpe_init">agwsubs.c</a>
<tr><td>References Variables:
<td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_sock</a><td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_if.c</a>

</table>

<hr>
<h2><a name="func-agw_tcp_init">Global Function agw_tcp_init()</a></h2>
DESC: setup the tcp connection to AGWPE							   
<p>
<tt><a href="agwpe_if.c.src.html#line47">int agw_tcp_init ( char* address, char* p )</a></tt><br>
<dl compact>
<dt><tt>int agw_tcp_init</tt>
<dd> Returns 1 on success, 0 on failure 
<dt><tt>char* address</tt>
<dd> Host name or IP address to use 
<dt><tt>char* p</tt>
<dd> Port number to use 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td colspan=2>atoi(), connect(), exit(), free(), gethostbyname(), herror(), htons(), memset(), perror(), printf(), socket()
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwpe_init">agwpe_init()</a><td><a href="agwsubs.c.html#func-agwpe_init">agwsubs.c</a>
<tr><td>References Variables:
<td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_sock</a><td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_if.c</a>
<tr><td>&nbsp;
<td><a href="agwpe_if.c.html#var-host">host</a><td><a href="agwpe_if.c.html#var-host">agwpe_if.c</a>
<tr><td>&nbsp;
<td><a href="agwpe_if.c.html#var-port">port</a><td><a href="agwpe_if.c.html#var-port">agwpe_if.c</a>

</table>

<hr>
<h2><a name="func-agw_tcp_send">Global Function agw_tcp_send()</a></h2>
Send a command to the AGW Packet Engine over the tcpip socket.
This version knows of sending the header only.
<p>
<tt><a href="agwpe_if.c.src.html#line120">void agw_tcp_send ( unsigned char* data, size_t size )</a></tt><br>
<dl compact>
<dt><tt>unsigned char* data</tt>
<dd> AGWPE header, containing the command 
<dt><tt>size_t size</tt>
<dd> Size of the data to send (inclusive header 
</dl>
Returns 1 on success,
        exits on a failure.
<p>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td colspan=2>exit(), perror(), printf(), send()
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwpe_connect">agwpe_connect()</a><td><a href="agwsubs.c.html#func-agwpe_connect">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_disconnect">agwpe_disconnect()</a><td><a href="agwsubs.c.html#func-agwpe_disconnect">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_get_portinfo">agwpe_get_portinfo()</a><td><a href="agwsubs.c.html#func-agwpe_get_portinfo">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_get_ver">agwpe_get_ver()</a><td><a href="agwsubs.c.html#func-agwpe_get_ver">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_heard">agwpe_heard()</a><td><a href="agwsubs.c.html#func-agwpe_heard">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_monitor">agwpe_monitor()</a><td><a href="agwsubs.c.html#func-agwpe_monitor">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_register">agwpe_register()</a><td><a href="agwsubs.c.html#func-agwpe_register">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_send_data">agwpe_send_data()</a><td><a href="agwsubs.c.html#func-agwpe_send_data">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_unregister">agwpe_unregister()</a><td><a href="agwsubs.c.html#func-agwpe_unregister">agwsubs.c</a>
<tr><td>References Variables:
<td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_sock</a><td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_if.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-agwdata_get">Global Function agwdata_get()</a></h2>
Description: Get AGWPE data out of the ringbuffer
<p>
<tt><a href="agwpe_if.c.src.html#line198">int agwdata_get ( RINGBUF* buf, size_t cnt, unsigned char* d )</a></tt><br>
<dl compact>
<dt><tt>int agwdata_get</tt>
<dd> Returns 1 on success, 0 if no data was available 
<dt><tt>RINGBUF* buf</tt>
<dd> Pointer to the rignbuffer 
<dt><tt>size_t cnt</tt>
<dd> Number of bytes to get out of buffer 
<dt><tt>unsigned char* d</tt>
<dd> Pointer to buffer to store the data in 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_cnt">ringbuf_cnt()</a><td><a href="ringbuf.c.html#func-ringbuf_cnt">ringbuf.c</a>
<tr><td>&nbsp;
<td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf_get()</a><td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf.c</a>
<tr><td>&nbsp;
<td colspan=2>perror(), printf()
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwpe_process">agwpe_process()</a><td><a href="agwsubs.c.html#func-agwpe_process">agwsubs.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-agwhdr_available">Global Function agwhdr_available()</a></h2>
Description: This function checks if ther are enough
databytes in the ringbuffer to contain a AGWPE header
<p>
<tt><a href="agwpe_if.c.src.html#line182">int agwhdr_available ( RINGBUF* ringbuf )</a></tt><br>
<dl compact>
<dt><tt>int agwhdr_available</tt>
<dd> Returns 0 if no header was available, 1 if there is enough data
in the buffer to contain a header 
<dt><tt>RINGBUF* ringbuf</tt>
<dd> Pointer to ringbuffer to use 
</dl>
Returns: 0 if no header available,
         1 if there is enough data to contain a header
<p>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_cnt">ringbuf_cnt()</a><td><a href="ringbuf.c.html#func-ringbuf_cnt">ringbuf.c</a>
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwhdr_get">agwhdr_get()</a><td><a href="agwsubs.c.html#func-agwhdr_get">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_process">agwpe_process()</a><td><a href="agwsubs.c.html#func-agwpe_process">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-get_tcp_data">Global Function get_tcp_data()</a></h2>
Description: Get data from the socket and store it
in the ring buffer. The socket number used is a global 
variable.
<p>
<tt><a href="agwpe_if.c.src.html#line145">void get_tcp_data ( RINGBUF* ringbuf )</a></tt><br>
<dl compact>
<dt><tt>RINGBUF* ringbuf</tt>
<dd> Pointer to ringbuf 
</dl>
 This is a static size for now 
<p>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="agwpe_if.h.html#file">agwpe_if.h</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_put">ringbuf_put()</a><td><a href="ringbuf.c.html#func-ringbuf_put">ringbuf.c</a>
<tr><td>&nbsp;
<td colspan=2>fcntl(), recv()
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwpe_process">agwpe_process()</a><td><a href="agwsubs.c.html#func-agwpe_process">agwsubs.c</a>
<tr><td>References Variables:
<td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_sock</a><td><a href="agwpe_if.c.html#var-agwpe_sock">agwpe_if.c</a>

</table>

</BODY>
</HTML>
