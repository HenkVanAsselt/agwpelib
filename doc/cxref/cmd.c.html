<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<!-- This HTML file generated by cxref. -->
<!-- cxref program (c) Andrew M. Bishop 1995,96,97,98,99. -->

<!--
Cxref: cxref -DTN_SRV -Id:/djgpp/include -O../doc/cxref -xref-all -Nsv2agw -index-all -html32 -html32-src cmd.c
CPP  : gcc -E -C -dD -dI -DTN_SRV -Id:/djgpp/include
-->

<HTML>

<HEAD>
<TITLE>Cross reference for cmd.c of sv2agw.</TITLE>
</HEAD>

<BODY>

<h1><a name="file" href="cmd.c.src.html">File cmd.c</a></h1>
<b>RCS Header: CMD.C Thu 08-24-2000 9:18:49 am HvA V1.00 </b>
<p>

This file contains the command interpreter.
It will build a command from getting data from the ringbuffer
If the terminator is encountered, it will interpretate and
execute the command
<p>

<hr>
<h2>Included Files</h2>

<ul>
<li><tt>#include &lt;d:/djgpp/include/stdio.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdlib.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/string.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdarg.h&gt;</tt>
</ul>
<ul>
<li><tt><a href="fortify.h.html#file">#include &quot;fortify.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdlib.h&gt;</tt>
<li><tt>#include &lt;string.h&gt;</tt>
<li><tt><a href="ufortify.h.html#file">#include &quot;ufortify.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="agwsubs.h.html#file">#include &quot;agwsubs.h&quot;</a></tt>
<ul>
<li><tt><a href="agwhdr.h.html#file">#include &quot;agwhdr.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdio.h&gt;</tt>
<li><tt>#include &lt;stdlib.h&gt;</tt>
</ul>
</ul>
<ul>
<li><tt><a href="tn_srv.h.html#file">#include &quot;tn_srv.h&quot;</a></tt>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="cmd.h.html#file">#include &quot;cmd.h&quot;</a></tt>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
</ul>
</ul>

<hr>
<h2>External Variables</h2>

<b><a name="var-agwpe_version">agwpe_version</a></b><br>
<tt><a href="cmd.c.src.html#line21">extern char agwpe_version[]</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-agwpe_version">agwsubs.c</a>

</table>
<p>
<b><a name="var-agwpe_portinfo">agwpe_portinfo</a></b><br>
<tt><a href="cmd.c.src.html#line22">extern char agwpe_portinfo[]</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-agwpe_portinfo">agwsubs.c</a>

</table>
<p>
<b><a name="var-mycall">mycall</a></b><br>
 Callsign of this station  
<p>
<tt><a href="cmd.c.src.html#line23">extern char mycall[]</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-mycall">agwsubs.c</a>

</table>
<p>
<b><a name="var-tocall">tocall</a></b><br>
 Callsign of other station 
<p>
<tt><a href="cmd.c.src.html#line24">extern char tocall[]</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-tocall">agwsubs.c</a>

</table>
<p>
<b><a name="var-agwpe_status">agwpe_status</a></b><br>
<tt><a href="cmd.c.src.html#line25">extern int agwpe_status</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2>Local Variables</h2>

<b><a name="var-cmd">cmd</a></b><br>
 Linear buffer (string) for the command 
<p>
<tt><a href="cmd.c.src.html#line27">static char cmd[160]</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-get_cmd">get_cmd()</a>

</table>
<p>
<b><a name="var-ptr">ptr</a></b><br>
 Pointer to postion in cmd buffer during build of command 
<p>
<tt><a href="cmd.c.src.html#line28">static int ptr</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-get_cmd">get_cmd()</a>

</table>

<hr>
<h2><a name="func-disp_prompt">Global Function disp_prompt()</a></h2>
Show prompt character. This is only done when were are in command mode
<p>
<tt><a href="cmd.c.src.html#line191">void disp_prompt ( void )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.h.html#file">cmd.h</a>
<tr><td>Calls:
<td><a href="tn_srv.c.html#func-tn_printf">tn_printf()</a><td><a href="tn_srv.c.html#func-tn_printf">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>printf()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-exec_cmd">Global Function exec_cmd()</a></h2>
Execute the command given.
<p>
<tt><a href="cmd.c.src.html#line58">int exec_cmd ( char* cmd )</a></tt><br>
<dl compact>
<dt><tt>int exec_cmd</tt>
<dd> Returns 0 on success, -1 on failure 
<dt><tt>char* cmd</tt>
<dd> Pointer to the command string to execute 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.h.html#file">cmd.h</a>
<tr><td>Calls:
<td><a href="agwsubs.c.html#func-agwpe_connect">agwpe_connect()</a><td><a href="agwsubs.c.html#func-agwpe_connect">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_disconnect">agwpe_disconnect()</a><td><a href="agwsubs.c.html#func-agwpe_disconnect">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-agwpe_heard">agwpe_heard()</a><td><a href="agwsubs.c.html#func-agwpe_heard">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-output">output()</a><td><a href="cmd.c.html#func-output">cmd.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-print_usage">print_usage()</a><td><a href="cmd.c.html#func-print_usage">cmd.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-tn_close_all">tn_close_all()</a><td><a href="tn_srv.c.html#func-tn_close_all">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>exit(), printf(), sscanf(), strstr(), strupr()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_portinfo">agwpe_portinfo</a><td><a href="agwsubs.c.html#var-agwpe_portinfo">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#var-agwpe_version">agwpe_version</a><td><a href="agwsubs.c.html#var-agwpe_version">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#var-tocall">tocall</a><td><a href="agwsubs.c.html#var-tocall">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-get_cmd">Global Function get_cmd()</a></h2>
Retrieve a command from the ringbuffer. If the command building
is still in progress, this function will return a NULL pointer. If
the terminators are found, then the command will be NIL terminated
and the pointer to the command will be returned.
<p>
<tt><a href="cmd.c.src.html#line135">char* get_cmd ( RINGBUF* buf )</a></tt><br>
<dl compact>
<dt><tt>char* get_cmd</tt>
<dd> Returns pointer to complete command, or NULL if command was not complete yet 
</dl>
 Number of bytes, retrieved from ring buffer 
<br>
 Byte, retrieved from ring buffer 
<p>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.h.html#file">cmd.h</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf_get()</a><td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-terminator">terminator()</a><td><a href="cmd.c.html#func-terminator">cmd.c</a>
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="cmd.c.html#var-cmd">cmd</a><td><a href="cmd.c.html#var-cmd">cmd.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#var-ptr">ptr</a><td><a href="cmd.c.html#var-ptr">cmd.c</a>

</table>

<hr>
<h2><a name="func-print_usage">Global Function print_usage()</a></h2>
Print command overview
<p>
<tt><a href="cmd.c.src.html#line40">void print_usage ( void )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.c.html#file">cmd.c</a>
<tr><td>Calls:
<td><a href="cmd.c.html#func-output">output()</a><td><a href="cmd.c.html#func-output">cmd.c</a>
<tr><td>Called by:
<td><a href="cmd.c.html#func-exec_cmd">exec_cmd()</a><td><a href="cmd.c.html#func-exec_cmd">cmd.c</a>

</table>

<hr>
<h2><a name="func-output">Local Function output()</a></h2>
Output string to stdout and to the telnet socket
<p>
<tt><a href="cmd.c.src.html#line208">static void output ( char* format, ... )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.c.html#file">cmd.c</a>
<tr><td>Calls:
<td><a href="tn_srv.c.html#func-tn_printf">tn_printf()</a><td><a href="tn_srv.c.html#func-tn_printf">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>__builtin_next_arg(), vprintf(), vsprintf()
<tr><td>Called by:
<td><a href="cmd.c.html#func-exec_cmd">exec_cmd()</a><td><a href="cmd.c.html#func-exec_cmd">cmd.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-print_usage">print_usage()</a><td><a href="cmd.c.html#func-print_usage">cmd.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-terminator">Local Function terminator()</a></h2>
Check if terminator CR is seen. If there is also a LF, it will
also be removed from the ring buffer.
<p>
<tt><a href="cmd.c.src.html#line166">static int terminator ( RINGBUF* buf )</a></tt><br>
<dl compact>
<dt><tt>int terminator</tt>
<dd> Return 1 if terminator is found, 0 if not 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="cmd.c.html#file">cmd.c</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf_get()</a><td><a href="ringbuf.c.html#func-ringbuf_get">ringbuf.c</a>
<tr><td>&nbsp;
<td><a href="ringbuf.c.html#func-ringbuf_peek">ringbuf_peek()</a><td><a href="ringbuf.c.html#func-ringbuf_peek">ringbuf.c</a>
<tr><td>Called by:
<td><a href="cmd.c.html#func-get_cmd">get_cmd()</a><td><a href="cmd.c.html#func-get_cmd">cmd.c</a>

</table>

</BODY>
</HTML>
