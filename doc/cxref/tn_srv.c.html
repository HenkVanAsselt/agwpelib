<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<!-- This HTML file generated by cxref. -->
<!-- cxref program (c) Andrew M. Bishop 1995,96,97,98,99. -->

<!--
Cxref: cxref -DTN_SRV -Id:/djgpp/include -O../doc/cxref -xref-all -Nsv2agw -index-all -html32 -html32-src tn_srv.c
CPP  : gcc -E -C -dD -dI -DTN_SRV -Id:/djgpp/include
-->

<HTML>

<HEAD>
<TITLE>Cross reference for tn_srv.c of sv2agw.</TITLE>
</HEAD>

<BODY>

<h1><a name="file" href="tn_srv.c.src.html">File tn_srv.c</a></h1>
<b>RCS Header: /djgpp/sv2agw/tn_srv.c 1.0 Mon 08-21-2000 3:53:22 pm </b>
<p>

Telnet interface for AGWPE/TCP
<p>

<hr>
<h2>Included Files</h2>

 Normal includes  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdio.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdlib.h&gt;</tt>
</ul>
 Includes for network functionality  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/netinet/in.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/sys/socket.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/netdb.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/arpa/inet.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/unistd.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/stdarg.h&gt;</tt>
</ul>
<ul>
<li><tt>#include &lt;d:/djgpp/include/lsck/lsck.h&gt;</tt>
</ul>
 For fnctl() -&gt; non-blocking  
<p>
<ul>
<li><tt>#include &lt;d:/djgpp/include/fcntl.h&gt;</tt>
</ul>
 Include own header files  
<p>
<ul>
<li><tt><a href="fortify.h.html#file">#include &quot;fortify.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdlib.h&gt;</tt>
<li><tt>#include &lt;d:/djgpp/include/string.h&gt;</tt>
<li><tt><a href="ufortify.h.html#file">#include &quot;ufortify.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
<ul>
<li><tt>#include &lt;stdio.h&gt;</tt>
<li><tt>#include &lt;stdlib.h&gt;</tt>
</ul>
</ul>
<ul>
<li><tt><a href="tn_srv.h.html#file">#include &quot;tn_srv.h&quot;</a></tt>
<ul>
<li><tt><a href="ringbuf.h.html#file">#include &quot;ringbuf.h&quot;</a></tt>
</ul>
</ul>
<ul>
<li><tt><a href="agwsubs.h.html#file">#include &quot;agwsubs.h&quot;</a></tt>
<ul>
<li><tt><a href="agwhdr.h.html#file">#include &quot;agwhdr.h&quot;</a></tt>
</ul>
</ul>

<hr>
<h2>Preprocessor definitions</h2>

<tt><a href="tn_srv.c.src.html#line139">#define BUFSIZE</a> 256</tt><br>

<hr>
<h2>External Variables</h2>

<b><a name="var-agwpe_status">agwpe_status</a></b><br>
 External variables 
<p>
<tt><a href="tn_srv.c.src.html#line41">extern int agwpe_status</a></tt><br>
<table>
<tr><td>Defined in:
<td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2>Local Variables</h2>

<b><a name="var-telnet_sock">telnet_sock</a></b><br>
 Local variables   Socket number which will be assigned to telnet client 
<p>
<tt><a href="tn_srv.c.src.html#line37">static int telnet_sock</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-check_conn_request">check_conn_request()</a>
<tr><td>&nbsp;
<td><a href="#func-get_telnet_data">get_telnet_data()</a>
<tr><td>&nbsp;
<td><a href="#func-get_telnet_sock">get_telnet_sock()</a>
<tr><td>&nbsp;
<td><a href="#func-main">main()</a>
<tr><td>&nbsp;
<td><a href="#func-send_telnet_data">send_telnet_data()</a>

</table>
<p>
<b><a name="var-listen_sock">listen_sock</a></b><br>
<tt><a href="tn_srv.c.src.html#line38">static int listen_sock</a></tt><br>
<table>
<tr><td>Used in:
<td><a href="#func-check_conn_request">check_conn_request()</a>
<tr><td>&nbsp;
<td><a href="#func-get_listen_sock">get_listen_sock()</a>
<tr><td>&nbsp;
<td><a href="#func-telnet_srv_init">telnet_srv_init()</a>

</table>

<hr>
<h2><a name="func-check_conn_request">Global Function check_conn_request()</a></h2>
Check if a connection request is made to the socket we listen on
<p>
<tt><a href="tn_srv.c.src.html#line89">int check_conn_request ( void )</a></tt><br>
<dl compact>
<dt><tt>int check_conn_request</tt>
<dd> Returns TN_DISCONNECTED if no request was made, return TN_CONNECTED if a conncetion was received 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td><a href="tn_srv.c.html#func-tn_printf">tn_printf()</a><td><a href="tn_srv.c.html#func-tn_printf">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>accept(), inet_ntoa(), perror(), printf()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#var-listen_sock">listen_sock</a><td><a href="tn_srv.c.html#var-listen_sock">tn_srv.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#var-telnet_sock">telnet_sock</a><td><a href="tn_srv.c.html#var-telnet_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-get_listen_sock">Global Function get_listen_sock()</a></h2>
Get the socket number of were we listen on
<p>
<tt><a href="tn_srv.c.src.html#line229">int get_listen_sock ( void )</a></tt><br>
<dl compact>
<dt><tt>int get_listen_sock</tt>
<dd> Returns socket number 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Called by:
<td><a href="tn_srv.c.html#func-tn_close_all">tn_close_all()</a><td><a href="tn_srv.c.html#func-tn_close_all">tn_srv.c</a>
<tr><td>References Variables:
<td><a href="tn_srv.c.html#var-listen_sock">listen_sock</a><td><a href="tn_srv.c.html#var-listen_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-get_telnet_data">Global Function get_telnet_data()</a></h2>
Description: Get data from the telnet client socket and store it
in the ring buffer. The socket number used is a global variable.
<p>
<tt><a href="tn_srv.c.src.html#line135">int get_telnet_data ( RINGBUF* ringbuf, int tn_sock )</a></tt><br>
<dl compact>
<dt><tt>int get_telnet_data</tt>
<dd> Returns number of bytes received (&gt;=0) or -1 if socket is closed 
<dt><tt>RINGBUF* ringbuf</tt>
<dd>&nbs;
<dt><tt>int tn_sock</tt>
<dd> Pointer to ringbuf 
</dl>
 This is a static size for now 
<p>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td><a href="ringbuf.c.html#func-ringbuf_put">ringbuf_put()</a><td><a href="ringbuf.c.html#func-ringbuf_put">ringbuf.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-tn_printf">tn_printf()</a><td><a href="tn_srv.c.html#func-tn_printf">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>fcntl(), printf(), recv()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#var-telnet_sock">telnet_sock</a><td><a href="tn_srv.c.html#var-telnet_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-get_telnet_sock">Global Function get_telnet_sock()</a></h2>
Get the socket number of the current telnet connection
<p>
<tt><a href="tn_srv.c.src.html#line219">int get_telnet_sock ( void )</a></tt><br>
<dl compact>
<dt><tt>int get_telnet_sock</tt>
<dd> Returns socket number 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-tn_close_all">tn_close_all()</a><td><a href="tn_srv.c.html#func-tn_close_all">tn_srv.c</a>
<tr><td>References Variables:
<td><a href="tn_srv.c.html#var-telnet_sock">telnet_sock</a><td><a href="tn_srv.c.html#var-telnet_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-send_telnet_data">Global Function send_telnet_data()</a></h2>
Send telnet data over the current connection. This assumes that
only 1 connection exists at a time
<p>
<tt><a href="tn_srv.c.src.html#line180">void send_telnet_data ( unsigned char* buf, int len )</a></tt><br>
<dl compact>
<dt><tt>unsigned char* buf</tt>
<dd>&nbs;
<dt><tt>int len</tt>
<dd> Data to send 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td colspan=2>exit(), perror(), send()
<tr><td>Called by:
<td><a href="tn_srv.c.html#func-tn_printf">tn_printf()</a><td><a href="tn_srv.c.html#func-tn_printf">tn_srv.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#var-telnet_sock">telnet_sock</a><td><a href="tn_srv.c.html#var-telnet_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-telnet_srv_init">Global Function telnet_srv_init()</a></h2>
Initialization function for listening on a port (23) for incoming
connection requests.
<p>
<tt><a href="tn_srv.c.src.html#line48">int telnet_srv_init ( char* port )</a></tt><br>
<dl compact>
<dt><tt>char* port</tt>
<dd> Port nr to listen on 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td colspan=2>atoi(), bind(), exit(), fcntl(), htons(), listen(), memset(), perror(), printf(), socket()
<tr><td>Called by:
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#var-listen_sock">listen_sock</a><td><a href="tn_srv.c.html#var-listen_sock">tn_srv.c</a>

</table>

<hr>
<h2><a name="func-tn_close">Global Function tn_close()</a></h2>
Description: Close socket used for the connection to AGWPE
<p>
<tt><a href="tn_srv.c.src.html#line197">void tn_close ( int socket )</a></tt><br>
<dl compact>
<dt><tt>int socket</tt>
<dd> Socket to close 
</dl>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td colspan=2>close(), fflush()
<tr><td>Called by:
<td><a href="tn_srv.c.html#func-tn_close_all">tn_close_all()</a><td><a href="tn_srv.c.html#func-tn_close_all">tn_srv.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-tn_close_all">Global Function tn_close_all()</a></h2>
Close all telnet sockets
<p>
<tt><a href="tn_srv.c.src.html#line239">void tn_close_all ( void )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td><a href="tn_srv.c.html#func-get_listen_sock">get_listen_sock()</a><td><a href="tn_srv.c.html#func-get_listen_sock">tn_srv.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-get_telnet_sock">get_telnet_sock()</a><td><a href="tn_srv.c.html#func-get_telnet_sock">tn_srv.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-tn_close">tn_close()</a><td><a href="tn_srv.c.html#func-tn_close">tn_srv.c</a>
<tr><td>Called by:
<td><a href="cmd.c.html#func-exec_cmd">exec_cmd()</a><td><a href="cmd.c.html#func-exec_cmd">cmd.c</a>
<tr><td>&nbsp;
<td><a href="test.c.html#func-main">main()</a><td><a href="test.c.html#func-main">test.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

<hr>
<h2><a name="func-tn_printf">Global Function tn_printf()</a></h2>
A printf function for the telnet connection
<p>
<tt><a href="tn_srv.c.src.html#line252">void tn_printf ( char* format, ... )</a></tt><br>
<table>
<tr><td>Prototyped in:
<td colspan=2><a href="tn_srv.h.html#file">tn_srv.h</a>
<tr><td>Calls:
<td><a href="tn_srv.c.html#func-send_telnet_data">send_telnet_data()</a><td><a href="tn_srv.c.html#func-send_telnet_data">tn_srv.c</a>
<tr><td>&nbsp;
<td colspan=2>__builtin_next_arg(), strlen(), vsprintf()
<tr><td>Called by:
<td><a href="agwsubs.c.html#func-agwpe_process">agwpe_process()</a><td><a href="agwsubs.c.html#func-agwpe_process">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-check_conn_request">check_conn_request()</a><td><a href="tn_srv.c.html#func-check_conn_request">tn_srv.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-disp_prompt">disp_prompt()</a><td><a href="cmd.c.html#func-disp_prompt">cmd.c</a>
<tr><td>&nbsp;
<td><a href="agwsubs.c.html#func-get_con_data">get_con_data()</a><td><a href="agwsubs.c.html#func-get_con_data">agwsubs.c</a>
<tr><td>&nbsp;
<td><a href="tn_srv.c.html#func-get_telnet_data">get_telnet_data()</a><td><a href="tn_srv.c.html#func-get_telnet_data">tn_srv.c</a>
<tr><td>&nbsp;
<td><a href="cmd.c.html#func-output">output()</a><td><a href="cmd.c.html#func-output">cmd.c</a>
<tr><td>References Variables:
<td><a href="agwsubs.c.html#var-agwpe_status">agwpe_status</a><td><a href="agwsubs.c.html#var-agwpe_status">agwsubs.c</a>

</table>

</BODY>
</HTML>
